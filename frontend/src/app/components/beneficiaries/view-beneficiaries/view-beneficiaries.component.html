<!-- Beneficiaries Header -->
<div class="d-flex justify-content-between align-items-center mb-4">
  <h1 class="h3 mb-0">
    <i class="fas fa-users me-2 text-primary"></i>
    All Beneficiaries
  </h1>
  <button class="btn btn-primary" (click)="addBeneficiary()">
    <i class="fas fa-plus me-2"></i>
    Add New Beneficiary
  </button>
</div>

<!-- Loading State -->
<div *ngIf="loading" class="text-center py-5">
  <div class="spinner-border text-primary" role="status">
    <span class="visually-hidden">Loading...</span>
  </div>
  <p class="mt-3 text-muted">Loading beneficiaries...</p>
</div>

<!-- Beneficiaries Content -->
<div *ngIf="!loading">
  <!-- Search and Filters -->
  <div class="card mb-4">
    <div class="card-body">
      <div class="row align-items-center">
        <div class="col-md-6 mb-2">
          <div class="input-group">
            <span class="input-group-text">
              <i class="fas fa-search"></i>
            </span>
            <input type="text" 
                   class="form-control" 
                   placeholder="Search by name, account, bank, or nickname..."
                   [(ngModel)]="searchQuery"
                   (input)="onSearch()">
          </div>
        </div>
        <div class="col-md-3 mb-2">
          <select class="form-control" [(ngModel)]="selectedCategory" (change)="onCategoryChange()">
            <option *ngFor="let cat of categories" [value]="cat.value">{{cat.label}}</option>
          </select>
        </div>
        <div class="col-md-3 mb-2">
          <select class="form-control" [(ngModel)]="selectedType" (change)="onTypeChange()">
            <option *ngFor="let type of types" [value]="type.value">{{type.label}}</option>
          </select>
        </div>
      </div>
      <div class="row mt-2">
        <div class="col-12">
                     <small class="text-muted">
             <i class="fas fa-info-circle me-1"></i>
             Found {{filteredBeneficiaries.length || 0}} of {{beneficiaries.length || 0}} beneficiaries
           </small>
        </div>
      </div>
    </div>
  </div>

  <!-- Beneficiaries List -->
  <div *ngIf="filteredBeneficiaries.length > 0" class="row">
    <div class="col-lg-6 col-xl-4 mb-4" *ngFor="let beneficiary of filteredBeneficiaries">
      <div class="card beneficiary-card h-100" 
           [class.opacity-50]="!beneficiary.isActive">
        <div class="card-body d-flex flex-column">
          <!-- Header -->
          <div class="d-flex align-items-center mb-3">
            <div class="beneficiary-icon me-3">
              <i [class]="getCategoryIcon(beneficiary.category)" 
                 class="text-primary"></i>
            </div>
            <div class="flex-grow-1">
              <h6 class="card-title mb-0">
                {{beneficiary.nickname || beneficiary.name}}
                <span *ngIf="!beneficiary.isActive" class="badge bg-secondary ms-2">
                  <i class="fas fa-eye-slash me-1"></i>Inactive
                </span>
              </h6>
              <small class="text-muted">{{beneficiary.name}}</small>
            </div>
            <div class="dropdown">
              <button class="btn btn-sm btn-link text-muted" 
                      data-bs-toggle="dropdown"
                      [disabled]="deleting">
                <i class="fas fa-ellipsis-v"></i>
              </button>
              <ul class="dropdown-menu">
                <li><a class="dropdown-item" (click)="makeTransfer(beneficiary)">
                  <i class="fas fa-paper-plane me-2 text-primary"></i>Make Transfer
                </a></li>
                <li><a class="dropdown-item" (click)="editBeneficiary(beneficiary)">
                  <i class="fas fa-edit me-2 text-warning"></i>Edit Details
                </a></li>
                <li><a class="dropdown-item" (click)="toggleStatus(beneficiary)">
                  <i [class]="beneficiary.isActive ? 'fas fa-pause' : 'fas fa-play'" 
                     class="me-2"
                     [class.text-warning]="beneficiary.isActive"
                     [class.text-success]="!beneficiary.isActive"></i>
                  {{beneficiary.isActive ? 'Deactivate' : 'Activate'}}
                </a></li>
                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item text-danger" (click)="deleteBeneficiary(beneficiary)">
                  <i class="fas fa-trash me-2"></i>Delete
                </a></li>
              </ul>
            </div>
          </div>

          <!-- Account Details -->
          <div class="mb-3">
            <p class="card-text mb-2">
              <i class="fas fa-building me-2 text-muted"></i>
              <strong>{{beneficiary.bankName}}</strong>
            </p>
            <p class="card-text mb-2">
              <i class="fas fa-credit-card me-2 text-muted"></i>
              <code class="text-primary">{{beneficiary.accountNumber}}</code>
            </p>
            <div *ngIf="beneficiary.routingNumber" class="mb-2">
              <small class="text-muted">
                <i class="fas fa-route me-1"></i>
                Routing: {{beneficiary.routingNumber}}
              </small>
            </div>
          </div>

          <!-- Contact Info -->
          <div class="mb-3" *ngIf="beneficiary.email || beneficiary.phone">
            <div *ngIf="beneficiary.email" class="mb-1">
              <small class="text-muted">
                <i class="fas fa-envelope me-1"></i>
                {{beneficiary.email}}
              </small>
            </div>
            <div *ngIf="beneficiary.phone" class="mb-1">
              <small class="text-muted">
                <i class="fas fa-phone me-1"></i>
                {{beneficiary.phone}}
              </small>
            </div>
          </div>

          <!-- Tags and Status -->
          <div class="mb-3">
            <span class="badge me-1"
                  [class.bg-primary]="beneficiary.category === 'PERSONAL'"
                  [class.bg-success]="beneficiary.category === 'BUSINESS'"
                  [class.bg-warning]="beneficiary.category === 'UTILITY'">
              {{beneficiary.category}}
            </span>
            <span class="badge"
                  [class.bg-info]="beneficiary.type === 'INTERNAL'"
                  [class.bg-secondary]="beneficiary.type === 'EXTERNAL'">
              <i [class]="getTypeIcon(beneficiary.type)" class="me-1"></i>
              {{beneficiary.type}}
            </span>
          </div>

          <!-- Last Used -->
          <div class="mt-auto">
            <small class="text-muted">
              <i class="fas fa-clock me-1"></i>
              <span *ngIf="beneficiary.lastUsed">
                Last used: {{beneficiary.lastUsed | date:'mediumDate'}}
              </span>
              <span *ngIf="!beneficiary.lastUsed">Never used</span>
            </small>
          </div>

          <!-- Quick Actions -->
          <div class="mt-3">
            <div class="btn-group w-100">
              <button class="btn btn-sm btn-primary" 
                      (click)="makeTransfer(beneficiary)"
                      [disabled]="!beneficiary.isActive">
                <i class="fas fa-paper-plane me-1"></i>
                Transfer
              </button>
              <button class="btn btn-sm btn-outline-primary" 
                      (click)="editBeneficiary(beneficiary)">
                <i class="fas fa-edit me-1"></i>
                Edit
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div *ngIf="filteredBeneficiaries.length === 0" class="card">
    <div class="card-body text-center py-5">
      <div *ngIf="searchQuery || selectedCategory !== 'ALL' || selectedType !== 'ALL'">
        <i class="fas fa-search fa-4x text-muted mb-3"></i>
        <h4>No Results Found</h4>
        <p class="text-muted mb-4">
          No beneficiaries match your current search and filter criteria.
        </p>
        <div class="d-flex gap-2 justify-content-center">
          <button class="btn btn-outline-primary" (click)="searchQuery = ''; selectedCategory = 'ALL'; selectedType = 'ALL'; onSearch()">
            <i class="fas fa-times me-2"></i>
            Clear Filters
          </button>
          <button class="btn btn-primary" (click)="addBeneficiary()">
            <i class="fas fa-plus me-2"></i>
            Add New Beneficiary
          </button>
        </div>
      </div>
      
      <div *ngIf="!searchQuery && selectedCategory === 'ALL' && selectedType === 'ALL'">
        <i class="fas fa-users fa-4x text-muted mb-3"></i>
        <h4>No Beneficiaries Yet</h4>
        <p class="text-muted mb-4">
          Start by adding your first beneficiary to make transfers and payments easier.
        </p>
        <button class="btn btn-primary btn-lg" (click)="addBeneficiary()">
          <i class="fas fa-plus me-2"></i>
          Add Your First Beneficiary
        </button>
      </div>
    </div>
  </div>

     <!-- Summary Stats -->
   <div class="card mt-4" *ngIf="beneficiaries && beneficiaries.length > 0">
    <div class="card-body">
      <div class="row text-center">
        <div class="col-md-3 mb-2">
          <div class="stat-item">
                         <h5 class="text-primary mb-0">{{beneficiaries.length || 0}}</h5>
            <small class="text-muted">Total Beneficiaries</small>
          </div>
        </div>
                 <div class="col-md-3 mb-2">
           <div class="stat-item">
             <h5 class="text-success mb-0">
               {{getActiveBeneficiariesCount()}}
             </h5>
             <small class="text-muted">Active</small>
           </div>
         </div>
         <div class="col-md-3 mb-2">
           <div class="stat-item">
             <h5 class="text-info mb-0">
               {{getInternalBeneficiariesCount()}}
             </h5>
             <small class="text-muted">Internal</small>
           </div>
         </div>
         <div class="col-md-3 mb-2">
           <div class="stat-item">
             <h5 class="text-secondary mb-0">
               {{getExternalBeneficiariesCount()}}
             </h5>
             <small class="text-muted">External</small>
           </div>
         </div>
      </div>
    </div>
  </div>
</div> 